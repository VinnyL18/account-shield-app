import pytestfrom brand_guard.detectors import analyze_url, OFFICIAL_BRANDSPHISHY_WORDS = ["login", "verify", "secure", "update", "confirm", "account"]SPOOF_TEMPLATES = [    "http://{brand}-login-alert.com",    "http://{brand}-verify.com",    "http://{brand}-secure-update.com",    "http://{brand}-account-confirm.com",]def has_flag(result, flag):    return flag in result.get("flags", [])# --------------------------------------------------# 1) OFFICIAL DOMAINS MUST BE SAFE@pytest.mark.parametrize(    "brand,domain",    [(b, d) for b, domains in OFFICIAL_BRANDS.items() for d in domains],)def test_official_domains_are_official(brand, domain):    r = analyze_url(f"https://{domain}")    assert isinstance(r, dict)    assert r["official"] is True    assert r.get("brand_score", 0) == 100    # Official sites must NOT trigger spoof flags    assert "brand_spoof_high_confidence" not in r.get("flags", [])    assert "brand_spoof_medium_confidence" not in r.get("flags", [])# --------------------------------------------------# 2) BRAND SPOOFS MUST BE FLAGGED# --------------------------------------------------@pytest.mark.parametrize(    "brand,url",    [        (brand, tpl.format(brand=brand))        for brand in OFFICIAL_BRANDS        for tpl in SPOOF_TEMPLATES    ],)def test_brand_spoofs_get_flagged(brand, url):    r = analyze_url(url)    assert r["brand"] == brand    assert r["official"] is False    assert r["brand_score"] >= 40    assert has_flag(r, "brand_spoof_high_confidence") or has_flag(        r, "brand_spoof_medium_confidence"    )# --------------------------------------------------# 3) BRAND + PHISHY WORD INCREASES SCORE# --------------------------------------------------@pytest.mark.parametrize(    "brand,word",    [(b, w) for b in OFFICIAL_BRANDS for w in PHISHY_WORDS],)def test_phishy_words_increase_risk(brand, word):    url = f"http://{brand}-{word}.com"    r = analyze_url(url)    assert r["brand"] == brand    min_score = 40 if len(brand) <= 2 else 50    assert r["brand_score"] >= min_score# --------------------------------------------------# 4) SHORT BRAND NAMES ARE PENALIZED# --------------------------------------------------@pytest.mark.parametrize("brand", ["aa", "up", "us"])def test_short_brand_penalty(brand):    r = analyze_url(f"http://{brand}-login.com")    assert r["brand_score"] < 70# --------------------------------------------------# 5) NO BRAND = NO SPOOF# --------------------------------------------------@pytest.mark.parametrize(    "url",    [        "https://example.com",        "https://mycoolwebsite.org",        "https://random-blog.net",    ],)def test_no_brand_is_clean(url):    r = analyze_url(url)    assert r["brand"] is None    assert not has_flag(r, "brand_spoof_high_confidence")